{"version":3,"sources":["../../test/init_tracer.js"],"names":["url","logger","info","msg","metrics","createCounter","increment","createGauge","createTimer","describe","it","config","serviceName","disable","tracer","to","be","an","instanceof","opentracing","Tracer","configs","_","each","throw","_sampler","RemoteSampler","_reporter","RemoteReporter","close","done","options","type","param","expectedType","ConstSampler","expectedParam","RateLimitingSampler","ProbabilisticSampler","samplerConfig","sampler","count","err","assert","equal","reporter","logSpans","agentHost","agentPort","flushIntervalMs","CompositeReporter","remoteReporter","i","_reporters","length","_bufferFlushInterval","_sender","_host","_port","instanceOf","UDPSender","protocol","collectorEndpoint","username","undefined","password","format","_url","HTTPSender","tags","x","contextKey","baggagePrefix","_logger","_metrics","_factory","_tags","textMapInjector","_injectors","FORMAT_TEXT_MAP","_contextKey","_baggagePrefix","throttler","refreshIntervalMs","_debugThrottler","RemoteThrottler","DefaultThrottler","afterEach","process","env","JAEGER_SERVICE_NAME","JAEGER_DISABLE","JAEGER_DISABLED","JAEGER_TAGS","JAEGER_SAMPLER_TYPE","JAEGER_SAMPLER_PARAM","JAEGER_SAMPLER_HOST","JAEGER_SAMPLER_PORT","JAEGER_SAMPLER_MANAGER_HOST_PORT","JAEGER_SAMPLER_REFRESH_INTERVAL","JAEGER_REPORTER_AGENT_PORT","JAEGER_AGENT_PORT","JAEGER_REPORTER_AGENT_HOST","JAEGER_AGENT_HOST","JAEGER_REPORTER_ENDPOINT","JAEGER_ENDPOINT","JAEGER_REPORTER_USER","JAEGER_USER","JAEGER_REPORTER_PASSWORD","JAEGER_PASSWORD","JAEGER_REPORTER_FLUSH_INTERVAL","JAEGER_REPORTER_LOG_SPANS","_serviceName","TEST_KEY","_samplingRate","_refreshInterval","href","_username","_password","host","port","KEY2"],"mappings":"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","file":"init_tracer.js","sourcesContent":["// Copyright (c) 2016 Uber Technologies, Inc.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except\n// in compliance with the License. You may obtain a copy of the License at\n//\n// http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software distributed under the License\n// is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express\n// or implied. See the License for the specific language governing permissions and limitations under\n// the License.\n\nimport _ from 'lodash';\nimport * as url from 'url';\nimport { assert, expect } from 'chai';\nimport CompositeReporter from '../src/reporters/composite_reporter';\nimport RemoteReporter from '../src/reporters/remote_reporter';\nimport ConstSampler from '../src/samplers/const_sampler';\nimport ProbabilisticSampler from '../src/samplers/probabilistic_sampler';\nimport RemoteSampler from '../src/samplers/remote_sampler';\nimport RateLimitingSampler from '../src/samplers/ratelimiting_sampler';\nimport { initTracer, initTracerFromEnv } from '../src/index.js';\nimport opentracing from 'opentracing';\nimport RemoteThrottler from '../src/throttler/remote_throttler';\nimport DefaultThrottler from '../src/throttler/default_throttler';\nimport HTTPSender from '../src/reporters/http_sender.js';\nimport UDPSender from '../src/reporters/udp_sender.js';\n\nconst logger = {\n  info: function info(msg) {},\n};\n\nconst metrics = {\n  createCounter: function createCounter() {\n    return {\n      increment: function() {},\n    };\n  },\n  createGauge: function createGauge() {\n    return {};\n  },\n  createTimer: function createTimer() {\n    return {};\n  },\n};\n\ndescribe('initTracer', () => {\n  it('should initialize noop tracer when disable is set', () => {\n    let config = {\n      serviceName: 'test-service',\n      disable: true,\n    };\n    let tracer = initTracer(config);\n\n    expect(tracer).to.be.an.instanceof(opentracing.Tracer);\n  });\n\n  it('should throw error on invalid serviceName', () => {\n    let configs = [{ serviceName: '' }, { serviceName: null }, {}];\n\n    _.each(configs, config => {\n      expect(() => {\n        initTracer(config);\n      }).to.throw('config.serviceName must be provided');\n    });\n  });\n\n  it('should initialize normal tracer when only service name given', done => {\n    let config = {\n      serviceName: 'test-service',\n    };\n    let tracer = initTracer(config);\n\n    expect(tracer._sampler).to.be.an.instanceof(RemoteSampler);\n    expect(tracer._reporter).to.be.an.instanceof(RemoteReporter);\n    tracer.close(done);\n  });\n\n  it('should initialize proper samplers', () => {\n    let config = {\n      serviceName: 'test-service',\n    };\n    let options = [\n      { type: 'const', param: 1, expectedType: ConstSampler, expectedParam: 1 },\n      { type: 'ratelimiting', param: 2, expectedType: RateLimitingSampler, expectedParam: 2 },\n      { type: 'probabilistic', param: 0.5, expectedType: ProbabilisticSampler, expectedParam: 0.5 },\n      { type: 'remote', param: 1, expectedType: RemoteSampler, expectedParam: 1 },\n    ];\n\n    _.each(options, samplerConfig => {\n      let expectedType = samplerConfig.expectedType;\n      let expectedParam = samplerConfig.expectedParam;\n      delete samplerConfig.expectedType;\n      delete samplerConfig.expectedParam;\n\n      config.sampler = samplerConfig;\n      let tracer = initTracer(config);\n\n      expect(tracer._sampler).to.be.an.instanceof(expectedType);\n      tracer.close();\n      // TODO(oibe:head) test utils for expectedParam here?\n    });\n  });\n\n  it('should throw error on sampler incorrect type', () => {\n    let config = {\n      serviceName: 'test-service',\n    };\n    let options = [\n      { type: 'const', param: 'bad-value' },\n      { type: 'ratelimiting', param: 'bad-value' },\n      { type: 'probabilistic', param: 'bad-value' },\n      { type: 'remote', param: 'bad-value' },\n    ];\n\n    let count = 0;\n    _.each(options, samplerConfig => {\n      config.sampler = samplerConfig;\n\n      // Since its an error from a third party framework, its hard to assert on\n      // using expect.\n      try {\n        initTracer(config);\n      } catch (err) {\n        count += 1;\n      }\n    });\n\n    assert.equal(count, 4);\n  });\n\n  describe('reporter options', () => {\n    it('should respect reporter options', done => {\n      let config = {\n        serviceName: 'test-service',\n        sampler: {\n          type: 'const',\n          param: 0,\n        },\n        reporter: {\n          logSpans: true,\n          agentHost: '127.0.0.1',\n          agentPort: 4939,\n          flushIntervalMs: 2000,\n        },\n      };\n      let tracer = initTracer(config);\n\n      expect(tracer._reporter).to.be.an.instanceof(CompositeReporter);\n      let remoteReporter;\n      for (let i = 0; i < tracer._reporter._reporters.length; i++) {\n        let reporter = tracer._reporter._reporters[i];\n        if (reporter instanceof RemoteReporter) {\n          remoteReporter = reporter;\n          break;\n        }\n      }\n\n      assert.equal(remoteReporter._bufferFlushInterval, 2000);\n      assert.equal(remoteReporter._sender._host, '127.0.0.1');\n      assert.equal(remoteReporter._sender._port, 4939);\n      assert.instanceOf(remoteReporter._sender, UDPSender);\n      tracer.close(done);\n    });\n\n    _.each(['http', 'https'], protocol => {\n      it(`should create an HTTPSender if protocol is ${protocol}`, done => {\n        let config = {\n          serviceName: 'test-service',\n          sampler: {\n            type: 'const',\n            param: 0,\n          },\n          reporter: {\n            logSpans: true,\n            collectorEndpoint: `${protocol}://127.0.0.1:4939/my/path`,\n            username: protocol === 'https' ? 'test' : undefined,\n            password: protocol === 'https' ? 'mypass' : undefined,\n            flushIntervalMs: 2000,\n          },\n        };\n        let tracer = initTracer(config);\n\n        expect(tracer._reporter).to.be.an.instanceof(CompositeReporter);\n        let remoteReporter;\n        for (let i = 0; i < tracer._reporter._reporters.length; i++) {\n          let reporter = tracer._reporter._reporters[i];\n          if (reporter instanceof RemoteReporter) {\n            remoteReporter = reporter;\n            break;\n          }\n        }\n\n        assert.equal(url.format(remoteReporter._sender._url), `${protocol}://127.0.0.1:4939/my/path`);\n        assert.instanceOf(remoteReporter._sender, HTTPSender);\n        tracer.close(done);\n      });\n    });\n  });\n\n  it('should pass options to tracer', done => {\n    let tracer = initTracer(\n      {\n        serviceName: 'test-service',\n      },\n      {\n        logger: logger,\n        metrics: metrics,\n        tags: {\n          x: 'y',\n        },\n        contextKey: 'custom-header',\n        baggagePrefix: 'prfx-',\n      }\n    );\n    assert.equal(tracer._logger, logger);\n    assert.equal(tracer._metrics._factory, metrics);\n    assert.equal(tracer._tags['x'], 'y');\n\n    const textMapInjector = tracer._injectors[opentracing.FORMAT_TEXT_MAP];\n    assert.equal(textMapInjector._contextKey, 'custom-header');\n    assert.equal(textMapInjector._baggagePrefix, 'prfx-');\n    tracer.close(done);\n  });\n\n  it('should pass options to remote sampler and reporter', done => {\n    let logger = {\n      info: function info(msg) {},\n    };\n    let metrics = {\n      createCounter: function createCounter() {\n        return {\n          increment: function() {},\n        };\n      },\n      createGauge: function createGauge() {\n        return {};\n      },\n      createTimer: function createTimer() {\n        return {};\n      },\n    };\n    let tracer = initTracer(\n      {\n        serviceName: 'test-service',\n        sampler: {\n          type: 'remote',\n          param: 0,\n        },\n      },\n      {\n        logger: logger,\n        metrics: metrics,\n      }\n    );\n    assert.equal(tracer._reporter._metrics._factory, metrics);\n    assert.equal(tracer._reporter._logger, logger);\n    assert.equal(tracer._sampler._metrics._factory, metrics);\n    assert.equal(tracer._sampler._logger, logger);\n    tracer.close(done);\n  });\n\n  it('should initialize throttler from config', () => {\n    const config = {\n      serviceName: 'test-service',\n      throttler: {\n        refreshIntervalMs: 60000,\n      },\n    };\n    const tracer = initTracer(config, { logger: logger, metrics: metrics });\n    expect(tracer._debugThrottler).to.be.an.instanceof(RemoteThrottler);\n  });\n\n  it('should delegate throttler initialization to tracer', () => {\n    const config = {\n      serviceName: 'test-service',\n    };\n    const tracer = initTracer(config);\n    expect(tracer._debugThrottler).to.be.an.instanceof(DefaultThrottler);\n  });\n\n  it('should use throttler passed in via options', () => {\n    const config = {\n      serviceName: 'test-service',\n    };\n    const throttler = new RemoteThrottler();\n    const tracer = initTracer(config, { throttler: throttler });\n    expect(tracer._debugThrottler).to.equal(throttler);\n    throttler.close();\n  });\n});\n\ndescribe('initTracerFromENV', () => {\n  afterEach(() => {\n    delete process.env.JAEGER_SERVICE_NAME;\n    delete process.env.JAEGER_DISABLE;\n    delete process.env.JAEGER_DISABLED;\n    delete process.env.JAEGER_TAGS;\n    delete process.env.JAEGER_SAMPLER_TYPE;\n    delete process.env.JAEGER_SAMPLER_PARAM;\n    delete process.env.JAEGER_SAMPLER_HOST;\n    delete process.env.JAEGER_SAMPLER_PORT;\n    delete process.env.JAEGER_SAMPLER_MANAGER_HOST_PORT;\n    delete process.env.JAEGER_SAMPLER_REFRESH_INTERVAL;\n    delete process.env.JAEGER_REPORTER_AGENT_PORT;\n    delete process.env.JAEGER_AGENT_PORT;\n    delete process.env.JAEGER_REPORTER_AGENT_HOST;\n    delete process.env.JAEGER_AGENT_HOST;\n    delete process.env.JAEGER_REPORTER_ENDPOINT;\n    delete process.env.JAEGER_ENDPOINT;\n    delete process.env.JAEGER_REPORTER_USER;\n    delete process.env.JAEGER_USER;\n    delete process.env.JAEGER_REPORTER_PASSWORD;\n    delete process.env.JAEGER_PASSWORD;\n    delete process.env.JAEGER_REPORTER_FLUSH_INTERVAL;\n    delete process.env.JAEGER_REPORTER_LOG_SPANS;\n  });\n\n  it('should initialize noop tracer with mismatching disable env is set', () => {\n    process.env.JAEGER_DISABLE = true;\n\n    let tracer = initTracerFromEnv();\n\n    expect(tracer).to.be.an.instanceof(opentracing.Tracer);\n  });\n\n  it('should initialize noop tracer with disable env is set', () => {\n    process.env.JAEGER_DISABLED = true;\n\n    let tracer = initTracerFromEnv();\n\n    expect(tracer).to.be.an.instanceof(opentracing.Tracer);\n  });\n\n  it('should initialize tracer from mismatching env', () => {\n    process.env.JAEGER_SERVICE_NAME = 'test-service';\n    process.env.JAEGER_DISABLE = false;\n\n    let tracer = initTracerFromEnv();\n    assert.equal(tracer._serviceName, 'test-service');\n\n    tracer.close();\n  });\n\n  it('should initialize tracer from env', () => {\n    process.env.JAEGER_SERVICE_NAME = 'test-service';\n    process.env.JAEGER_DISABLED = false;\n\n    let tracer = initTracerFromEnv();\n    assert.equal(tracer._serviceName, 'test-service');\n\n    tracer.close();\n  });\n\n  it('should throw error on no serviceName', () => {\n    delete process.env.JAEGER_SERVICE_NAME;\n    expect(() => {\n      initTracerFromEnv();\n    }).to.throw('config.serviceName must be provided');\n  });\n\n  it('should parse tags', () => {\n    process.env.JAEGER_SERVICE_NAME = 'test-service';\n    process.env.JAEGER_DISABLED = false;\n    process.env.JAEGER_TAGS = 'KEY1=${TEST_KEY:VALUE1}, KEY2=VALUE2,KEY3=${TEST_KEY2:VALUE3}';\n    process.env.TEST_KEY = 'VALUE4';\n    let tracer = initTracerFromEnv();\n    assert.equal(tracer._tags['KEY1'], 'VALUE4');\n    assert.equal(tracer._tags['KEY2'], 'VALUE2');\n    assert.equal(tracer._tags['KEY3'], 'VALUE3');\n\n    tracer.close();\n  });\n\n  it('should initialize proper samplers from env', () => {\n    process.env.JAEGER_SERVICE_NAME = 'test-service';\n\n    process.env.JAEGER_SAMPLER_TYPE = 'probabilistic';\n    process.env.JAEGER_SAMPLER_PARAM = 0.5;\n    let tracer = initTracerFromEnv();\n    expect(tracer._sampler).to.be.an.instanceof(ProbabilisticSampler);\n    assert.equal(tracer._sampler._samplingRate, 0.5);\n    tracer.close();\n\n    process.env.JAEGER_SAMPLER_TYPE = 'remote';\n    process.env.JAEGER_SAMPLER_MANAGER_HOST_PORT = 'localhost:8080';\n    process.env.JAEGER_SAMPLER_REFRESH_INTERVAL = 100;\n    tracer = initTracerFromEnv();\n    expect(tracer._sampler).to.be.an.instanceof(RemoteSampler);\n    assert.equal(tracer._sampler._host, 'localhost');\n    assert.equal(tracer._sampler._port, 8080);\n    assert.equal(tracer._sampler._refreshInterval, 100);\n    tracer.close();\n  });\n\n  it('should initialize proper samplers from mismatching env', () => {\n    process.env.JAEGER_SERVICE_NAME = 'test-service';\n\n    process.env.JAEGER_SAMPLER_TYPE = 'probabilistic';\n    process.env.JAEGER_SAMPLER_PARAM = 0.5;\n    let tracer = initTracerFromEnv();\n    expect(tracer._sampler).to.be.an.instanceof(ProbabilisticSampler);\n    assert.equal(tracer._sampler._samplingRate, 0.5);\n    tracer.close();\n\n    process.env.JAEGER_SAMPLER_TYPE = 'remote';\n    process.env.JAEGER_SAMPLER_HOST = 'localhost';\n    process.env.JAEGER_SAMPLER_PORT = 8080;\n    process.env.JAEGER_SAMPLER_REFRESH_INTERVAL = 100;\n    tracer = initTracerFromEnv();\n    expect(tracer._sampler).to.be.an.instanceof(RemoteSampler);\n    assert.equal(tracer._sampler._host, 'localhost');\n    assert.equal(tracer._sampler._port, 8080);\n    assert.equal(tracer._sampler._refreshInterval, 100);\n    tracer.close();\n  });\n\n  it('should respect udp reporter options from env', done => {\n    process.env.JAEGER_SERVICE_NAME = 'test-service';\n    process.env.JAEGER_REPORTER_LOG_SPANS = 'true';\n    process.env.JAEGER_AGENT_HOST = '127.0.0.1';\n    process.env.JAEGER_AGENT_PORT = 4939;\n    process.env.JAEGER_REPORTER_FLUSH_INTERVAL = 2000;\n\n    let tracer = initTracerFromEnv();\n    expect(tracer._reporter).to.be.an.instanceof(CompositeReporter);\n    let remoteReporter;\n    for (let i = 0; i < tracer._reporter._reporters.length; i++) {\n      let reporter = tracer._reporter._reporters[i];\n      if (reporter instanceof RemoteReporter) {\n        remoteReporter = reporter;\n        break;\n      }\n    }\n\n    assert.equal(remoteReporter._bufferFlushInterval, 2000);\n    assert.equal(remoteReporter._sender._host, '127.0.0.1');\n    assert.equal(remoteReporter._sender._port, 4939);\n    assert.instanceOf(remoteReporter._sender, UDPSender);\n\n    tracer.close(done);\n  });\n\n  it('should respect udp reporter options from mismatching env', done => {\n    process.env.JAEGER_SERVICE_NAME = 'test-service';\n    process.env.JAEGER_REPORTER_LOG_SPANS = 'true';\n    process.env.JAEGER_REPORTER_AGENT_HOST = '127.0.0.1';\n    process.env.JAEGER_REPORTER_AGENT_PORT = 4939;\n    process.env.JAEGER_REPORTER_FLUSH_INTERVAL = 2000;\n\n    let tracer = initTracerFromEnv();\n    expect(tracer._reporter).to.be.an.instanceof(CompositeReporter);\n    let remoteReporter;\n    for (let i = 0; i < tracer._reporter._reporters.length; i++) {\n      let reporter = tracer._reporter._reporters[i];\n      if (reporter instanceof RemoteReporter) {\n        remoteReporter = reporter;\n        break;\n      }\n    }\n\n    assert.equal(remoteReporter._bufferFlushInterval, 2000);\n    assert.equal(remoteReporter._sender._host, '127.0.0.1');\n    assert.equal(remoteReporter._sender._port, 4939);\n    assert.instanceOf(remoteReporter._sender, UDPSender);\n\n    tracer.close(done);\n  });\n\n  it('should respect http reporter options from env', done => {\n    process.env.JAEGER_SERVICE_NAME = 'test-service';\n    process.env.JAEGER_REPORTER_FLUSH_INTERVAL = 3000;\n    process.env.JAEGER_ENDPOINT = 'http://127.0.0.1:8080';\n    process.env.JAEGER_USER = 'test';\n    process.env.JAEGER_PASSWORD = 'xxxx';\n\n    let tracer = initTracerFromEnv();\n    expect(tracer._reporter).to.be.an.instanceof(RemoteReporter);\n    assert.instanceOf(tracer._reporter._sender, HTTPSender);\n    assert.equal(tracer._reporter._bufferFlushInterval, 3000);\n    assert.equal(tracer._reporter._sender._url.href, 'http://127.0.0.1:8080/');\n    assert.equal(tracer._reporter._sender._username, 'test');\n    assert.equal(tracer._reporter._sender._password, 'xxxx');\n\n    tracer.close(done);\n  });\n\n  it('should respect http reporter options from mismatching env', done => {\n    process.env.JAEGER_SERVICE_NAME = 'test-service';\n    process.env.JAEGER_REPORTER_FLUSH_INTERVAL = 3000;\n    process.env.JAEGER_REPORTER_ENDPOINT = 'http://127.0.0.1:8080';\n    process.env.JAEGER_REPORTER_USER = 'test';\n    process.env.JAEGER_REPORTER_PASSWORD = 'xxxx';\n\n    let tracer = initTracerFromEnv();\n    expect(tracer._reporter).to.be.an.instanceof(RemoteReporter);\n    assert.instanceOf(tracer._reporter._sender, HTTPSender);\n    assert.equal(tracer._reporter._bufferFlushInterval, 3000);\n    assert.equal(tracer._reporter._sender._url.href, 'http://127.0.0.1:8080/');\n    assert.equal(tracer._reporter._sender._username, 'test');\n    assert.equal(tracer._reporter._sender._password, 'xxxx');\n\n    tracer.close(done);\n  });\n\n  it('should be overridden via direct config setting.', done => {\n    process.env.JAEGER_SERVICE_NAME = 'test-service';\n    process.env.JAEGER_DISABLED = false;\n    process.env.JAEGER_SAMPLER_TYPE = 'const';\n    process.env.JAEGER_SAMPLER_PARAM = 1;\n    process.env.JAEGER_TAGS = 'KEY1=VALUE1';\n\n    let config = {\n      serviceName: 'test-service-arg',\n      sampler: {\n        type: 'remote',\n        host: 'localhost',\n        port: 8080,\n        refreshIntervalMs: 100,\n      },\n    };\n    let options = {\n      tags: {\n        KEY2: 'VALUE2',\n      },\n    };\n    let tracer = initTracerFromEnv(config, options);\n    assert.equal(tracer._serviceName, 'test-service-arg');\n    expect(tracer._sampler).to.be.an.instanceof(RemoteSampler);\n    assert.equal(tracer._sampler._host, 'localhost');\n    assert.equal(tracer._sampler._port, 8080);\n    assert.equal(tracer._sampler._refreshInterval, 100);\n    assert.equal(tracer._tags['KEY2'], 'VALUE2');\n    tracer.close(done);\n  });\n});\n"]}